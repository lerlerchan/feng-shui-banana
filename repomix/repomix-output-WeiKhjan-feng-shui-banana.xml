This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where security check has been disabled.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Security check has been disabled - content may contain sensitive information
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  file.svg
  globe.svg
  next.svg
  vercel.svg
  window.svg
src/
  app/
    api/
      bazi/
        route.ts
      gemini/
        analyze/
          route.ts
    bazi/
      result/
        page.tsx
      page.tsx
    outfit/
      page.tsx
    favicon.ico
    globals.css
    layout.tsx
    page.tsx
  lib/
    bazi.ts
    elements.ts
    gemini.ts
  types/
    lunar-javascript.d.ts
.gitignore
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
README.md
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="src/app/api/bazi/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { calculateBazi } from '@/lib/bazi';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { gender, birthDate, birthTime } = body;

    if (!birthDate) {
      return NextResponse.json(
        { error: 'Birth date is required' },
        { status: 400 }
      );
    }

    const result = calculateBazi(birthDate, birthTime || undefined);

    return NextResponse.json(result);
  } catch (error) {
    console.error('BaZi calculation error:', error);
    return NextResponse.json(
      { error: 'Failed to calculate BaZi' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/api/gemini/analyze/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { analyzeOutfit } from '@/lib/gemini';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { image, luckyColors, unluckyColors } = body;

    if (!image) {
      return NextResponse.json(
        { error: 'Image is required' },
        { status: 400 }
      );
    }

    const result = await analyzeOutfit(image, luckyColors || [], unluckyColors || []);

    return NextResponse.json(result);
  } catch (error) {
    console.error('Gemini analysis error:', error);
    return NextResponse.json(
      { error: 'Failed to analyze outfit' },
      { status: 500 }
    );
  }
}
</file>

<file path="src/app/bazi/result/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

interface BaziResult {
  chart: {
    year: { stem: string; branch: string; stemElement: string; branchElement: string };
    month: { stem: string; branch: string; stemElement: string; branchElement: string };
    day: { stem: string; branch: string; stemElement: string; branchElement: string };
    hour: { stem: string; branch: string; stemElement: string; branchElement: string } | null;
  };
  elementBalance: { metal: number; wood: number; water: number; fire: number; earth: number };
  luckyColors: { color: string; code: string; element: string }[];
  unluckyColors: { color: string; code: string; element: string }[];
  dayMaster: string;
  dayMasterElement: string;
}

export default function BaziResultPage() {
  const router = useRouter();
  const [result, setResult] = useState<BaziResult | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchResult = async () => {
      const stored = sessionStorage.getItem('baziInput');
      if (!stored) { router.push('/bazi'); return; }
      try {
        const input = JSON.parse(stored);
        const response = await fetch('/api/bazi', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(input),
        });
        if (!response.ok) throw new Error('Failed');
        const data = await response.json();
        setResult(data);
        sessionStorage.setItem('baziResult', JSON.stringify(data));
      } catch { setError('Failed to analyze. Please try again.'); }
      finally { setLoading(false); }
    };
    fetchResult();
  }, [router]);

  if (loading) return (<div className='min-h-screen bg-[var(--sepia-50)] flex items-center justify-center'><p>Analyzing...</p></div>);
  if (error || !result) return (<div className='min-h-screen bg-[var(--sepia-50)] flex items-center justify-center'><p>{error}</p><Link href='/bazi'>Go back</Link></div>);

  return (
    <div className='min-h-screen bg-[var(--sepia-50)]'>
      <header className='border-b border-[var(--sepia-200)] bg-white/80 backdrop-blur-sm sticky top-0 z-50'>
        <div className='max-w-6xl mx-auto px-4 py-4'><Link href='/' className='text-2xl font-serif text-[var(--sepia-800)]'><span className='font-bold'>Feng Shui</span> Banana</Link></div>
      </header>
      <main className='max-w-4xl mx-auto px-4 py-12'>
        <h1 className='text-3xl font-serif text-[var(--sepia-900)] mb-8 text-center'>Your BaZi Chart</h1>
        <div className='bg-white p-6 rounded-xl shadow-sm border border-[var(--sepia-200)] mb-8'>
          <h2 className='text-xl font-serif text-[var(--sepia-800)] mb-4 text-center'>Four Pillars</h2>
          <div className='grid grid-cols-4 gap-4'>
            {(['year', 'month', 'day', 'hour'] as const).map((pillar) => {
              const p = result.chart[pillar];
              if (!p) return <div key={pillar} className='text-center p-4 bg-[var(--sepia-50)] rounded-lg opacity-50'><div className='text-sm'>Hour</div><div className='text-2xl'>--</div></div>;
              return <div key={pillar} className='text-center p-4 bg-[var(--sepia-50)] rounded-lg'><div className='text-sm capitalize'>{pillar}</div><div className='text-3xl font-serif text-[var(--sepia-800)]'>{p.stem}{p.branch}</div></div>;
            })}
          </div>
        </div>
        <div className='grid md:grid-cols-2 gap-6 mb-8'>
          <div className='bg-white p-6 rounded-xl shadow-sm border border-[var(--sepia-200)]'>
            <h2 className='text-xl font-serif text-[var(--sepia-800)] mb-4'>Lucky Colors</h2>
            <div className='grid grid-cols-2 gap-3'>{result.luckyColors.slice(0, 6).map((c, i) => <div key={i} className='flex items-center gap-2 p-2 rounded-lg bg-[var(--sepia-50)]'><div className='w-8 h-8 rounded-full' style={{ backgroundColor: c.code }} /><span className='text-sm'>{c.color}</span></div>)}</div>
          </div>
          <div className='bg-white p-6 rounded-xl shadow-sm border border-[var(--sepia-200)]'>
            <h2 className='text-xl font-serif text-[var(--sepia-800)] mb-4'>Colors to Avoid</h2>
            <div className='grid grid-cols-2 gap-3'>{result.unluckyColors.slice(0, 4).map((c, i) => <div key={i} className='flex items-center gap-2 p-2 rounded-lg bg-[var(--sepia-50)]'><div className='w-8 h-8 rounded-full' style={{ backgroundColor: c.code }} /><span className='text-sm'>{c.color}</span></div>)}</div>
          </div>
        </div>
        <div className='flex gap-4 justify-center'>
          <Link href='/outfit' className='px-8 py-4 bg-[var(--sepia-700)] text-white rounded-lg'>Check My Outfit</Link>
          <Link href='/bazi' className='px-8 py-4 border-2 border-[var(--sepia-400)] text-[var(--sepia-700)] rounded-lg'>New Analysis</Link>
        </div>
      </main>
    </div>
  );
}
</file>

<file path="src/app/bazi/page.tsx">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function BaziPage() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    gender: 'male',
    birthDate: '',
    birthTime: '',
  });
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    
    // Store form data in sessionStorage and navigate to results
    sessionStorage.setItem('baziInput', JSON.stringify(formData));
    router.push('/bazi/result');
  };

  return (
    <div className="min-h-screen bg-[var(--sepia-50)]">
      {/* Header */}
      <header className="border-b border-[var(--sepia-200)] bg-white/80 backdrop-blur-sm sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
          <Link href="/" className="text-2xl font-serif text-[var(--sepia-800)]">
            <span className="font-bold">Feng Shui</span> Banana
          </Link>
          <nav className="flex gap-6">
            <Link href="/bazi" className="text-[var(--sepia-800)] font-medium">
              BaZi Analysis
            </Link>
            <Link href="/outfit" className="text-[var(--sepia-600)] hover:text-[var(--sepia-800)] transition-colors">
              Outfit Check
            </Link>
          </nav>
        </div>
      </header>

      <main className="max-w-2xl mx-auto px-4 py-16">
        <div className="text-center mb-12 animate-fade-in">
          <div className="text-5xl mb-4">üîÆ</div>
          <h1 className="text-3xl font-serif text-[var(--sepia-900)] mb-2">
            BaZi Analysis ¬∑ ÂÖ´Â≠óÂàÜÊûê
          </h1>
          <p className="text-[var(--sepia-600)]">
            Enter your birth details to discover your elemental destiny
          </p>
        </div>

        <form onSubmit={handleSubmit} className="bg-white p-8 rounded-xl shadow-sm border border-[var(--sepia-200)] animate-fade-in" style={{animationDelay: '0.1s'}}>
          {/* Gender */}
          <div className="mb-6">
            <label className="block text-[var(--sepia-700)] font-medium mb-3">
              Gender ¬∑ ÊÄßÂà´
            </label>
            <div className="flex gap-4">
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="radio"
                  name="gender"
                  value="male"
                  checked={formData.gender === 'male'}
                  onChange={(e) => setFormData({ ...formData, gender: e.target.value })}
                  className="w-4 h-4 accent-[var(--sepia-600)]"
                />
                <span className="text-[var(--sepia-700)]">Male ¬∑ Áî∑</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="radio"
                  name="gender"
                  value="female"
                  checked={formData.gender === 'female'}
                  onChange={(e) => setFormData({ ...formData, gender: e.target.value })}
                  className="w-4 h-4 accent-[var(--sepia-600)]"
                />
                <span className="text-[var(--sepia-700)]">Female ¬∑ Â•≥</span>
              </label>
            </div>
          </div>

          {/* Birth Date */}
          <div className="mb-6">
            <label className="block text-[var(--sepia-700)] font-medium mb-2">
              Birth Date ¬∑ Âá∫ÁîüÊó•Êúü <span className="text-[var(--sepia-400)]">*</span>
            </label>
            <input
              type="date"
              required
              value={formData.birthDate}
              onChange={(e) => setFormData({ ...formData, birthDate: e.target.value })}
              className="w-full px-4 py-3 border border-[var(--sepia-300)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--sepia-400)] bg-white text-[var(--sepia-800)]"
            />
          </div>

          {/* Birth Time (Optional) */}
          <div className="mb-8">
            <label className="block text-[var(--sepia-700)] font-medium mb-2">
              Birth Time ¬∑ Âá∫ÁîüÊó∂Èó¥ <span className="text-[var(--sepia-400)] text-sm">(Optional)</span>
            </label>
            <input
              type="time"
              value={formData.birthTime}
              onChange={(e) => setFormData({ ...formData, birthTime: e.target.value })}
              className="w-full px-4 py-3 border border-[var(--sepia-300)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--sepia-400)] bg-white text-[var(--sepia-800)]"
            />
            <p className="text-sm text-[var(--sepia-500)] mt-2">
              Providing birth time allows for a more accurate Hour Pillar calculation
            </p>
          </div>

          {/* Submit Button */}
          <button
            type="submit"
            disabled={loading || !formData.birthDate}
            className="w-full py-4 bg-[var(--sepia-700)] text-white rounded-lg hover:bg-[var(--sepia-800)] transition-colors font-medium text-lg disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {loading ? (
              <span className="flex items-center justify-center gap-2">
                <span className="animate-pulse-gentle">Analyzing...</span>
              </span>
            ) : (
              'Analyze My BaZi ¬∑ ÂàÜÊûêÊàëÁöÑÂÖ´Â≠ó'
            )}
          </button>
        </form>

        {/* Info Box */}
        <div className="mt-8 p-6 bg-[var(--sepia-100)] rounded-xl animate-fade-in" style={{animationDelay: '0.2s'}}>
          <h3 className="font-serif text-lg text-[var(--sepia-800)] mb-2">What is BaZi? ¬∑ ‰ªÄ‰πàÊòØÂÖ´Â≠ó?</h3>
          <p className="text-[var(--sepia-600)] text-sm leading-relaxed">
            BaZi (ÂÖ´Â≠ó), also known as Four Pillars of Destiny, is an ancient Chinese astrological system that uses your birth date and time to create a chart of eight characters. These characters represent the balance of Five Elements (‰∫îË°å) in your life, which can guide decisions including what colors to wear for better fortune.
          </p>
        </div>
      </main>
    </div>
  );
}
</file>

<file path="src/app/outfit/page.tsx">
'use client';

import { useEffect, useRef, useState, useCallback } from 'react';
import Link from 'next/link';

interface AnalysisResult {
  analysis: string;
  detectedColors: string[];
  colorMatch: 'excellent' | 'good' | 'neutral' | 'poor';
  suggestions: string[];
}

interface BaziColors {
  luckyColors: { color: string; code: string; element: string }[];
  unluckyColors: { color: string; code: string; element: string }[];
}

export default function OutfitPage() {
  const videoRef = useRef<HTMLVideoElement>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [mode, setMode] = useState<'camera' | 'upload'>('camera');
  const [stream, setStream] = useState<MediaStream | null>(null);
  const [analyzing, setAnalyzing] = useState(false);
  const [result, setResult] = useState<AnalysisResult | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [baziColors, setBaziColors] = useState<BaziColors | null>(null);
  const [uploadedImage, setUploadedImage] = useState<string | null>(null);
  const [cameraReady, setCameraReady] = useState(false);
  const [isDragging, setIsDragging] = useState(false);

  // Load BaZi colors from sessionStorage
  useEffect(() => {
    const stored = sessionStorage.getItem('baziResult');
    if (stored) {
      const data = JSON.parse(stored);
      setBaziColors({ luckyColors: data.luckyColors || [], unluckyColors: data.unluckyColors || [] });
    }
  }, []);

  // Initialize camera when mode is 'camera'
  const startCamera = useCallback(async () => {
    try {
      setError(null);
      const mediaStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'user', width: { ideal: 1280 }, height: { ideal: 720 } }
      });
      setStream(mediaStream);
      if (videoRef.current) {
        videoRef.current.srcObject = mediaStream;
        videoRef.current.onloadedmetadata = () => {
          setCameraReady(true);
        };
      }
    } catch (err) {
      console.error('Camera error:', err);
      setError('Unable to access camera. Please check permissions or try uploading an image instead.');
      setCameraReady(false);
    }
  }, []);

  // Stop camera stream
  const stopCamera = useCallback(() => {
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      setStream(null);
      setCameraReady(false);
    }
  }, [stream]);

  // Handle mode changes
  useEffect(() => {
    if (mode === 'camera') {
      startCamera();
    } else {
      stopCamera();
    }
    return () => {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }
    };
  }, [mode]);

  // Capture photo from camera
  const capturePhoto = useCallback(() => {
    if (!videoRef.current || !canvasRef.current || !cameraReady) return null;

    const video = videoRef.current;
    const canvas = canvasRef.current;
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const ctx = canvas.getContext('2d');
    if (!ctx) return null;

    ctx.drawImage(video, 0, 0);
    return canvas.toDataURL('image/jpeg', 0.8);
  }, [cameraReady]);

  // Handle file upload
  const handleFileUpload = useCallback((file: File) => {
    if (!file.type.startsWith('image/')) {
      setError('Please upload an image file.');
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const result = e.target?.result as string;
      setUploadedImage(result);
      setError(null);
      setResult(null);
    };
    reader.onerror = () => {
      setError('Failed to read the image file.');
    };
    reader.readAsDataURL(file);
  }, []);

  // Handle file input change
  const handleFileInputChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      handleFileUpload(file);
    }
  }, [handleFileUpload]);

  // Handle drag and drop
  const handleDragOver = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  }, []);

  const handleDragLeave = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
  }, []);

  const handleDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    const file = e.dataTransfer.files?.[0];
    if (file) {
      handleFileUpload(file);
    }
  }, [handleFileUpload]);

  // Analyze outfit
  const analyzeOutfit = useCallback(async () => {
    setAnalyzing(true);
    setError(null);
    setResult(null);

    try {
      let imageData: string | null = null;

      if (mode === 'camera') {
        imageData = capturePhoto();
      } else {
        imageData = uploadedImage;
      }

      if (!imageData) {
        setError('No image available. Please capture or upload an image first.');
        setAnalyzing(false);
        return;
      }

      const response = await fetch('/api/gemini/analyze', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          image: imageData,
          luckyColors: baziColors?.luckyColors || [],
          unluckyColors: baziColors?.unluckyColors || [],
        }),
      });

      if (!response.ok) {
        throw new Error('Failed to analyze outfit');
      }

      const data = await response.json();
      setResult(data);
    } catch (err) {
      console.error('Analysis error:', err);
      setError('Failed to analyze outfit. Please try again.');
    } finally {
      setAnalyzing(false);
    }
  }, [mode, capturePhoto, uploadedImage, baziColors]);

  // Get color match badge styles
  const getColorMatchStyles = (match: string) => {
    switch (match) {
      case 'excellent':
        return 'bg-green-100 text-green-800 border-green-300';
      case 'good':
        return 'bg-blue-100 text-blue-800 border-blue-300';
      case 'neutral':
        return 'bg-yellow-100 text-yellow-800 border-yellow-300';
      case 'poor':
        return 'bg-red-100 text-red-800 border-red-300';
      default:
        return 'bg-gray-100 text-gray-800 border-gray-300';
    }
  };

  const getColorMatchLabel = (match: string) => {
    switch (match) {
      case 'excellent':
        return 'Excellent Match';
      case 'good':
        return 'Good Match';
      case 'neutral':
        return 'Neutral';
      case 'poor':
        return 'Poor Match';
      default:
        return match;
    }
  };

  return (
    <div className="min-h-screen bg-[var(--sepia-50)]">
      {/* Header */}
      <header className="border-b border-[var(--sepia-200)] bg-white/80 backdrop-blur-sm sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
          <Link href="/" className="text-2xl font-serif text-[var(--sepia-800)]">
            <span className="font-bold">Feng Shui</span> Banana
          </Link>
          <nav className="flex gap-6">
            <Link href="/bazi" className="text-[var(--sepia-600)] hover:text-[var(--sepia-800)] transition-colors">
              BaZi Analysis
            </Link>
            <Link href="/outfit" className="text-[var(--sepia-800)] font-medium">
              Outfit Check
            </Link>
          </nav>
        </div>
      </header>

      <main className="max-w-4xl mx-auto px-4 py-8">
        {/* Page Title */}
        <div className="text-center mb-8 animate-fade-in">
          <div className="text-5xl mb-4">üì∏</div>
          <h1 className="text-3xl font-serif text-[var(--sepia-900)] mb-2">
            Outfit Analysis
          </h1>
          <p className="text-[var(--sepia-600)]">
            Capture or upload your outfit to see how it aligns with your lucky colors
          </p>
        </div>

        {/* BaZi Colors Display */}
        {baziColors && (baziColors.luckyColors.length > 0 || baziColors.unluckyColors.length > 0) && (
          <div className="bg-white p-6 rounded-xl shadow-sm border border-[var(--sepia-200)] mb-6 animate-fade-in" style={{animationDelay: '0.1s'}}>
            <h3 className="font-serif text-lg text-[var(--sepia-800)] mb-4">Your BaZi Colors</h3>
            <div className="grid grid-cols-2 gap-4">
              {baziColors.luckyColors.length > 0 && (
                <div>
                  <p className="text-sm text-[var(--sepia-600)] mb-2">Lucky Colors</p>
                  <div className="flex flex-wrap gap-2">
                    {baziColors.luckyColors.map((c, i) => (
                      <div
                        key={i}
                        className="flex items-center gap-2 px-3 py-1 rounded-full bg-[var(--sepia-100)] border border-[var(--sepia-200)]"
                      >
                        <span
                          className="w-4 h-4 rounded-full border border-[var(--sepia-300)]"
                          style={{ backgroundColor: c.code }}
                        />
                        <span className="text-sm text-[var(--sepia-700)]">{c.color}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              {baziColors.unluckyColors.length > 0 && (
                <div>
                  <p className="text-sm text-[var(--sepia-600)] mb-2">Unlucky Colors</p>
                  <div className="flex flex-wrap gap-2">
                    {baziColors.unluckyColors.map((c, i) => (
                      <div
                        key={i}
                        className="flex items-center gap-2 px-3 py-1 rounded-full bg-[var(--sepia-100)] border border-[var(--sepia-200)]"
                      >
                        <span
                          className="w-4 h-4 rounded-full border border-[var(--sepia-300)]"
                          style={{ backgroundColor: c.code }}
                        />
                        <span className="text-sm text-[var(--sepia-700)]">{c.color}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {/* No BaZi Warning */}
        {!baziColors && (
          <div className="bg-[var(--sepia-100)] p-4 rounded-xl border border-[var(--sepia-300)] mb-6 animate-fade-in" style={{animationDelay: '0.1s'}}>
            <p className="text-[var(--sepia-700)] text-center">
              No BaZi analysis found.{' '}
              <Link href="/bazi" className="text-[var(--sepia-800)] font-medium underline hover:text-[var(--sepia-900)]">
                Get your BaZi analysis first
              </Link>{' '}
              for personalized color recommendations.
            </p>
          </div>
        )}

        {/* Mode Toggle */}
        <div className="flex justify-center mb-6 animate-fade-in" style={{animationDelay: '0.15s'}}>
          <div className="inline-flex rounded-lg border border-[var(--sepia-300)] bg-white p-1">
            <button
              onClick={() => {
                setMode('camera');
                setResult(null);
                setError(null);
              }}
              className={`px-6 py-2 rounded-md text-sm font-medium transition-colors ${
                mode === 'camera'
                  ? 'bg-[var(--sepia-700)] text-white'
                  : 'text-[var(--sepia-600)] hover:text-[var(--sepia-800)]'
              }`}
            >
              Camera
            </button>
            <button
              onClick={() => {
                setMode('upload');
                setResult(null);
                setError(null);
              }}
              className={`px-6 py-2 rounded-md text-sm font-medium transition-colors ${
                mode === 'upload'
                  ? 'bg-[var(--sepia-700)] text-white'
                  : 'text-[var(--sepia-600)] hover:text-[var(--sepia-800)]'
              }`}
            >
              Upload
            </button>
          </div>
        </div>

        {/* Camera / Upload Area */}
        <div className="bg-white p-6 rounded-xl shadow-sm border border-[var(--sepia-200)] mb-6 animate-fade-in" style={{animationDelay: '0.2s'}}>
          {mode === 'camera' ? (
            <div className="space-y-4">
              {/* Video Feed */}
              <div className="relative aspect-video bg-black rounded-lg overflow-hidden">
                <video
                  ref={videoRef}
                  autoPlay
                  playsInline
                  muted
                  className="w-full h-full object-cover"
                />
                {!cameraReady && !error && (
                  <div className="absolute inset-0 flex items-center justify-center bg-[var(--sepia-900)]/80">
                    <div className="text-center text-white">
                      <div className="animate-spin w-8 h-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-2" />
                      <p>Starting camera...</p>
                    </div>
                  </div>
                )}
              </div>
              {/* Hidden canvas for capturing */}
              <canvas ref={canvasRef} className="hidden" />
              {/* Capture Button */}
              <button
                onClick={analyzeOutfit}
                disabled={!cameraReady || analyzing}
                className="w-full py-4 bg-[var(--sepia-700)] text-white rounded-lg hover:bg-[var(--sepia-800)] transition-colors font-medium text-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              >
                {analyzing ? (
                  <>
                    <span className="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full" />
                    Analyzing...
                  </>
                ) : (
                  'Capture & Analyze'
                )}
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              {/* Upload Area */}
              <div
                onClick={() => fileInputRef.current?.click()}
                onDragOver={handleDragOver}
                onDragLeave={handleDragLeave}
                onDrop={handleDrop}
                className={`relative aspect-video rounded-lg border-2 border-dashed transition-colors cursor-pointer flex items-center justify-center ${
                  isDragging
                    ? 'border-[var(--sepia-500)] bg-[var(--sepia-100)]'
                    : 'border-[var(--sepia-300)] bg-[var(--sepia-50)] hover:border-[var(--sepia-400)] hover:bg-[var(--sepia-100)]'
                }`}
              >
                {uploadedImage ? (
                  <img
                    src={uploadedImage}
                    alt="Uploaded outfit"
                    className="w-full h-full object-contain rounded-lg"
                  />
                ) : (
                  <div className="text-center p-8">
                    <div className="text-4xl mb-4">üì§</div>
                    <p className="text-[var(--sepia-700)] font-medium mb-2">
                      Click or drag to upload
                    </p>
                    <p className="text-sm text-[var(--sepia-500)]">
                      Supports JPG, PNG, GIF
                    </p>
                  </div>
                )}
              </div>
              <input
                ref={fileInputRef}
                type="file"
                accept="image/*"
                onChange={handleFileInputChange}
                className="hidden"
              />
              {/* Analyze Button */}
              <button
                onClick={analyzeOutfit}
                disabled={!uploadedImage || analyzing}
                className="w-full py-4 bg-[var(--sepia-700)] text-white rounded-lg hover:bg-[var(--sepia-800)] transition-colors font-medium text-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              >
                {analyzing ? (
                  <>
                    <span className="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full" />
                    Analyzing...
                  </>
                ) : (
                  'Analyze Outfit'
                )}
              </button>
              {uploadedImage && (
                <button
                  onClick={() => {
                    setUploadedImage(null);
                    setResult(null);
                    setError(null);
                  }}
                  className="w-full py-2 text-[var(--sepia-600)] hover:text-[var(--sepia-800)] transition-colors text-sm"
                >
                  Clear image
                </button>
              )}
            </div>
          )}
        </div>

        {/* Error Display */}
        {error && (
          <div className="bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl mb-6 animate-fade-in">
            <div className="flex items-start gap-3">
              <span className="text-xl">‚ö†Ô∏è</span>
              <p>{error}</p>
            </div>
          </div>
        )}

        {/* Results Card */}
        {result && (
          <div className="bg-white p-6 rounded-xl shadow-sm border border-[var(--sepia-200)] animate-fade-in">
            <h2 className="text-xl font-serif text-[var(--sepia-900)] mb-4">Analysis Results</h2>

            {/* Color Match Badge */}
            <div className="mb-6">
              <span
                className={`inline-block px-4 py-2 rounded-full text-sm font-medium border ${getColorMatchStyles(
                  result.colorMatch
                )}`}
              >
                {getColorMatchLabel(result.colorMatch)}
              </span>
            </div>

            {/* Analysis Text */}
            <div className="mb-6">
              <h3 className="text-sm font-medium text-[var(--sepia-600)] mb-2">Analysis</h3>
              <p className="text-[var(--sepia-800)] leading-relaxed">{result.analysis}</p>
            </div>

            {/* Detected Colors */}
            {result.detectedColors && result.detectedColors.length > 0 && (
              <div className="mb-6">
                <h3 className="text-sm font-medium text-[var(--sepia-600)] mb-2">Detected Colors</h3>
                <div className="flex flex-wrap gap-2">
                  {result.detectedColors.map((color, i) => (
                    <span
                      key={i}
                      className="px-3 py-1 rounded-full bg-[var(--sepia-100)] text-[var(--sepia-700)] text-sm border border-[var(--sepia-200)]"
                    >
                      {color}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {/* Suggestions */}
            {result.suggestions && result.suggestions.length > 0 && (
              <div>
                <h3 className="text-sm font-medium text-[var(--sepia-600)] mb-2">Suggestions</h3>
                <ul className="space-y-2">
                  {result.suggestions.map((suggestion, i) => (
                    <li key={i} className="flex items-start gap-2 text-[var(--sepia-700)]">
                      <span className="text-[var(--sepia-400)]">‚Ä¢</span>
                      <span>{suggestion}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        )}

        {/* Tips Section */}
        <div className="mt-8 p-6 bg-[var(--sepia-100)] rounded-xl animate-fade-in" style={{animationDelay: '0.3s'}}>
          <h3 className="font-serif text-lg text-[var(--sepia-800)] mb-2">Tips for Best Results</h3>
          <ul className="text-[var(--sepia-600)] text-sm leading-relaxed space-y-1">
            <li>‚Ä¢ Ensure good lighting when capturing your outfit</li>
            <li>‚Ä¢ Include your full outfit in the frame</li>
            <li>‚Ä¢ Stand against a neutral background for better color detection</li>
            <li>‚Ä¢ Remove filters from uploaded images for accurate analysis</li>
          </ul>
        </div>
      </main>
    </div>
  );
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";

:root {
  /* Primary Sepia Tones */
  --sepia-50: #fdf8f3;
  --sepia-100: #f5ebe0;
  --sepia-200: #e8d5c4;
  --sepia-300: #d4b896;
  --sepia-400: #c4a574;
  --sepia-500: #a67c52;
  --sepia-600: #8b6342;
  --sepia-700: #6f4e34;
  --sepia-800: #5a3e2b;
  --sepia-900: #3d2b1f;

  /* Five Element Colors */
  --element-metal: #C0C0C0;
  --element-metal-light: #E8E8E8;
  --element-wood: #2D5A27;
  --element-wood-light: #90EE90;
  --element-water: #1E3A5F;
  --element-water-light: #87CEEB;
  --element-fire: #B22222;
  --element-fire-light: #FFB6C1;
  --element-earth: #8B7355;
  --element-earth-light: #DEB887;

  /* Theme colors */
  --background: var(--sepia-50);
  --foreground: var(--sepia-900);
  --card-background: #ffffff;
  --card-border: var(--sepia-200);
  --muted: var(--sepia-500);
  --accent: var(--sepia-600);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-sepia-50: var(--sepia-50);
  --color-sepia-100: var(--sepia-100);
  --color-sepia-200: var(--sepia-200);
  --color-sepia-300: var(--sepia-300);
  --color-sepia-400: var(--sepia-400);
  --color-sepia-500: var(--sepia-500);
  --color-sepia-600: var(--sepia-600);
  --color-sepia-700: var(--sepia-700);
  --color-sepia-800: var(--sepia-800);
  --color-sepia-900: var(--sepia-900);
  --font-sans: var(--font-inter);
  --font-serif: var(--font-noto-serif-sc);
}

* {
  box-sizing: border-box;
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: var(--font-sans), Arial, Helvetica, sans-serif;
  min-height: 100vh;
}

/* Custom scrollbar with sepia theme */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--sepia-100);
}

::-webkit-scrollbar-thumb {
  background: var(--sepia-400);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--sepia-500);
}

/* Utility classes for elements */
.element-metal { color: var(--element-metal); }
.element-wood { color: var(--element-wood); }
.element-water { color: var(--element-water); }
.element-fire { color: var(--element-fire); }
.element-earth { color: var(--element-earth); }

.bg-element-metal { background-color: var(--element-metal-light); }
.bg-element-wood { background-color: var(--element-wood-light); }
.bg-element-water { background-color: var(--element-water-light); }
.bg-element-fire { background-color: var(--element-fire-light); }
.bg-element-earth { background-color: var(--element-earth-light); }

/* Animation utilities */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-fade-in {
  animation: fadeIn 0.5s ease-out forwards;
}

@keyframes pulse-gentle {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.animate-pulse-gentle {
  animation: pulse-gentle 2s ease-in-out infinite;
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import { Inter, Noto_Serif_SC } from "next/font/google";
import "./globals.css";

const inter = Inter({
  variable: "--font-inter",
  subsets: ["latin"],
});

const notoSerifSC = Noto_Serif_SC({
  variable: "--font-noto-serif-sc",
  subsets: ["latin"],
  weight: ["400", "600", "700"],
});

export const metadata: Metadata = {
  title: "Feng Shui Banana | ÂÖ´Â≠óÂàÜÊûê",
  description: "AI-powered BaZi analysis with personalized clothing color recommendations based on the Five Elements",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${inter.variable} ${notoSerifSC.variable} antialiased bg-[var(--sepia-50)]`}
      >
        {children}
      </body>
    </html>
  );
}
</file>

<file path="src/app/page.tsx">
'use client';

import Link from 'next/link';

export default function Home() {
  return (
    <div className="min-h-screen bg-[var(--sepia-50)]">
      {/* Header */}
      <header className="border-b border-[var(--sepia-200)] bg-white/80 backdrop-blur-sm sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
          <h1 className="text-2xl font-serif text-[var(--sepia-800)]">
            <span className="font-bold">Feng Shui</span> Banana
          </h1>
          <nav className="flex gap-6">
            <Link href="/bazi" className="text-[var(--sepia-600)] hover:text-[var(--sepia-800)] transition-colors">
              BaZi Analysis
            </Link>
            <Link href="/outfit" className="text-[var(--sepia-600)] hover:text-[var(--sepia-800)] transition-colors">
              Outfit Check
            </Link>
          </nav>
        </div>
      </header>

      {/* Hero Section */}
      <main className="max-w-6xl mx-auto px-4 py-16">
        <div className="text-center mb-16 animate-fade-in">
          <div className="text-6xl mb-6">üçå</div>
          <h2 className="text-4xl md:text-5xl font-serif text-[var(--sepia-900)] mb-4">
            ÂÖ´Â≠óÂàÜÊûê ¬∑ BaZi Analysis
          </h2>
          <p className="text-xl text-[var(--sepia-600)] max-w-2xl mx-auto mb-8">
            Discover your lucky colors based on the ancient wisdom of Five Elements.
            Let AI guide your daily outfit choices.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Link
              href="/bazi"
              className="px-8 py-4 bg-[var(--sepia-700)] text-white rounded-lg hover:bg-[var(--sepia-800)] transition-colors text-lg font-medium"
            >
              Start Analysis ¬∑ ÂºÄÂßãÂàÜÊûê
            </Link>
            <Link
              href="/outfit"
              className="px-8 py-4 border-2 border-[var(--sepia-400)] text-[var(--sepia-700)] rounded-lg hover:bg-[var(--sepia-100)] transition-colors text-lg font-medium"
            >
              Check Outfit ¬∑ Ê£ÄÊü•Á©øÊê≠
            </Link>
          </div>
        </div>

        {/* Features */}
        <div className="grid md:grid-cols-3 gap-8 mb-16">
          <div className="bg-white p-8 rounded-xl shadow-sm border border-[var(--sepia-200)] animate-fade-in" style={{animationDelay: '0.1s'}}>
            <div className="text-4xl mb-4">üîÆ</div>
            <h3 className="text-xl font-serif text-[var(--sepia-800)] mb-2">
              BaZi Chart ¬∑ ÂÖ´Â≠óÂëΩÁõò
            </h3>
            <p className="text-[var(--sepia-600)]">
              Input your birth date to generate your personal Four Pillars chart and discover your elemental balance.
            </p>
          </div>

          <div className="bg-white p-8 rounded-xl shadow-sm border border-[var(--sepia-200)] animate-fade-in" style={{animationDelay: '0.2s'}}>
            <div className="text-4xl mb-4">üé®</div>
            <h3 className="text-xl font-serif text-[var(--sepia-800)] mb-2">
              Lucky Colors ¬∑ Âπ∏ËøêËâ≤ÂΩ©
            </h3>
            <p className="text-[var(--sepia-600)]">
              Get personalized color recommendations based on the Five Elements to enhance your daily fortune.
            </p>
          </div>

          <div className="bg-white p-8 rounded-xl shadow-sm border border-[var(--sepia-200)] animate-fade-in" style={{animationDelay: '0.3s'}}>
            <div className="text-4xl mb-4">üì∏</div>
            <h3 className="text-xl font-serif text-[var(--sepia-800)] mb-2">
              AI Analysis ¬∑ Êô∫ËÉΩÂàÜÊûê
            </h3>
            <p className="text-[var(--sepia-600)]">
              Upload your outfit or use live camera for instant AI feedback on how well your clothes align with your lucky colors.
            </p>
          </div>
        </div>

        {/* Five Elements */}
        <div className="bg-white p-8 rounded-xl shadow-sm border border-[var(--sepia-200)] mb-16">
          <h3 className="text-2xl font-serif text-[var(--sepia-800)] mb-6 text-center">
            The Five Elements ¬∑ ‰∫îË°å
          </h3>
          <div className="grid grid-cols-5 gap-4">
            <div className="text-center p-4">
              <div className="w-16 h-16 mx-auto rounded-full bg-element-metal flex items-center justify-center text-2xl mb-2">ü™ô</div>
              <div className="font-serif text-lg">Èáë</div>
              <div className="text-sm text-[var(--sepia-500)]">Metal</div>
            </div>
            <div className="text-center p-4">
              <div className="w-16 h-16 mx-auto rounded-full bg-element-wood flex items-center justify-center text-2xl mb-2">üå≥</div>
              <div className="font-serif text-lg">Êú®</div>
              <div className="text-sm text-[var(--sepia-500)]">Wood</div>
            </div>
            <div className="text-center p-4">
              <div className="w-16 h-16 mx-auto rounded-full bg-element-water flex items-center justify-center text-2xl mb-2">üíß</div>
              <div className="font-serif text-lg">Ê∞¥</div>
              <div className="text-sm text-[var(--sepia-500)]">Water</div>
            </div>
            <div className="text-center p-4">
              <div className="w-16 h-16 mx-auto rounded-full bg-element-fire flex items-center justify-center text-2xl mb-2">üî•</div>
              <div className="font-serif text-lg">ÁÅ´</div>
              <div className="text-sm text-[var(--sepia-500)]">Fire</div>
            </div>
            <div className="text-center p-4">
              <div className="w-16 h-16 mx-auto rounded-full bg-element-earth flex items-center justify-center text-2xl mb-2">üåç</div>
              <div className="font-serif text-lg">Âúü</div>
              <div className="text-sm text-[var(--sepia-500)]">Earth</div>
            </div>
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="border-t border-[var(--sepia-200)] bg-white/50 py-8">
        <div className="max-w-6xl mx-auto px-4 text-center text-[var(--sepia-500)]">
          <p>Feng Shui Banana ¬∑ Powered by Gemini AI</p>
          <p className="text-sm mt-2">Ancient wisdom meets modern technology</p>
        </div>
      </footer>
    </div>
  );
}
</file>

<file path="src/lib/bazi.ts">
// BaZi calculation logic using lunar-javascript
import { Solar } from 'lunar-javascript';
import { Element, ELEMENTS, getLuckyColors, getUnluckyColors } from './elements';

const HEAVENLY_STEMS = ['Áî≤', '‰πô', '‰∏ô', '‰∏Å', 'Êàä', 'Â∑±', 'Â∫ö', 'Ëæõ', 'Â£¨', 'Áô∏'];
const HEAVENLY_STEMS_PINYIN = ['Jia', 'Yi', 'Bing', 'Ding', 'Wu', 'Ji', 'Geng', 'Xin', 'Ren', 'Gui'];
const EARTHLY_BRANCHES = ['Â≠ê', '‰∏ë', 'ÂØÖ', 'ÂçØ', 'Ëæ∞', 'Â∑≥', 'Âçà', 'Êú™', 'Áî≥', 'ÈÖâ', 'Êàå', '‰∫•'];
const EARTHLY_BRANCHES_PINYIN = ['Zi', 'Chou', 'Yin', 'Mao', 'Chen', 'Si', 'Wu', 'Wei', 'Shen', 'You', 'Xu', 'Hai'];

const STEM_ELEMENTS: Record<string, Element> = {
  'Áî≤': 'wood', '‰πô': 'wood', '‰∏ô': 'fire', '‰∏Å': 'fire',
  'Êàä': 'earth', 'Â∑±': 'earth', 'Â∫ö': 'metal', 'Ëæõ': 'metal',
  'Â£¨': 'water', 'Áô∏': 'water',
};

const BRANCH_ELEMENTS: Record<string, Element> = {
  'Â≠ê': 'water', '‰∏ë': 'earth', 'ÂØÖ': 'wood', 'ÂçØ': 'wood',
  'Ëæ∞': 'earth', 'Â∑≥': 'fire', 'Âçà': 'fire', 'Êú™': 'earth',
  'Áî≥': 'metal', 'ÈÖâ': 'metal', 'Êàå': 'earth', '‰∫•': 'water',
};

export interface Pillar {
  stem: string;
  stemPinyin: string;
  branch: string;
  branchPinyin: string;
  stemElement: Element;
  branchElement: Element;
}

export interface BaziChart {
  year: Pillar;
  month: Pillar;
  day: Pillar;
  hour: Pillar | null;
}

export interface ElementBalance {
  metal: number;
  wood: number;
  water: number;
  fire: number;
  earth: number;
}

export interface BaziAnalysis {
  chart: BaziChart;
  elementBalance: ElementBalance;
  strongestElement: Element;
  weakestElement: Element;
  luckyElements: Element[];
  unluckyElements: Element[];
  luckyColors: { color: string; code: string; element: Element }[];
  unluckyColors: { color: string; code: string; element: Element }[];
  dayMaster: string;
  dayMasterElement: Element;
}

function createPillar(stem: string, branch: string): Pillar {
  const stemIndex = HEAVENLY_STEMS.indexOf(stem);
  const branchIndex = EARTHLY_BRANCHES.indexOf(branch);
  return {
    stem,
    stemPinyin: HEAVENLY_STEMS_PINYIN[stemIndex] || stem,
    branch,
    branchPinyin: EARTHLY_BRANCHES_PINYIN[branchIndex] || branch,
    stemElement: STEM_ELEMENTS[stem] || 'earth',
    branchElement: BRANCH_ELEMENTS[branch] || 'earth',
  };
}

export function calculateBazi(birthDate: string, birthTime?: string): BaziAnalysis {
  const [year, month, day] = birthDate.split('-').map(Number);
  const solar = Solar.fromYmd(year, month, day);
  const lunar = solar.getLunar();
  const eightChar = lunar.getEightChar();
  
  const yearPillar = createPillar(eightChar.getYearGan(), eightChar.getYearZhi());
  const monthPillar = createPillar(eightChar.getMonthGan(), eightChar.getMonthZhi());
  const dayPillar = createPillar(eightChar.getDayGan(), eightChar.getDayZhi());
  
  let hourPillar: Pillar | null = null;
  if (birthTime) {
    const [hours] = birthTime.split(':').map(Number);
    const solarTime = Solar.fromYmdHms(year, month, day, hours, 0, 0);
    const lunarTime = solarTime.getLunar();
    const eightCharTime = lunarTime.getEightChar();
    hourPillar = createPillar(eightCharTime.getTimeGan(), eightCharTime.getTimeZhi());
  }
  
  const chart: BaziChart = { year: yearPillar, month: monthPillar, day: dayPillar, hour: hourPillar };
  const elementBalance: ElementBalance = { metal: 0, wood: 0, water: 0, fire: 0, earth: 0 };
  
  const pillars = [yearPillar, monthPillar, dayPillar];
  if (hourPillar) pillars.push(hourPillar);
  
  pillars.forEach(pillar => {
    elementBalance[pillar.stemElement] += 1;
    elementBalance[pillar.branchElement] += 1;
  });
  
  const sortedElements = Object.entries(elementBalance).sort((a, b) => b[1] - a[1]) as [Element, number][];
  const strongestElement = sortedElements[0][0];
  const weakestElement = sortedElements[sortedElements.length - 1][0];
  
  const dayMaster = dayPillar.stem;
  const dayMasterElement = dayPillar.stemElement;
  
  const luckyElements: Element[] = [];
  const unluckyElements: Element[] = [];
  
  const generating: Record<Element, Element> = {
    wood: 'water', fire: 'wood', earth: 'fire', metal: 'earth', water: 'metal',
  };
  const controlling: Record<Element, Element> = {
    wood: 'metal', fire: 'water', earth: 'wood', metal: 'fire', water: 'earth',
  };
  
  luckyElements.push(generating[dayMasterElement]);
  luckyElements.push(dayMasterElement);
  unluckyElements.push(controlling[dayMasterElement]);
  
  const luckyColors = getLuckyColors(luckyElements);
  const unluckyColors = getUnluckyColors(strongestElement);
  
  return {
    chart, elementBalance, strongestElement, weakestElement,
    luckyElements, unluckyElements, luckyColors, unluckyColors,
    dayMaster, dayMasterElement,
  };
}

export function getDailyRecommendation(userBazi: BaziAnalysis, targetDate?: string) {
  const date = targetDate || new Date().toISOString().split('T')[0];
  const [year, month, day] = date.split('-').map(Number);
  const solar = Solar.fromYmd(year, month, day);
  const lunar = solar.getLunar();
  const eightChar = lunar.getEightChar();
  
  const dayElement = STEM_ELEMENTS[eightChar.getDayGan()];
  const isExtraLucky = userBazi.luckyElements.includes(dayElement);
  
  let recommendation = '';
  if (isExtraLucky) {
    recommendation = 'Today aligns with your chart! Great day for ' + ELEMENTS[dayElement].colors[0] + '.';
  } else if (userBazi.unluckyElements.includes(dayElement)) {
    recommendation = 'Balance today with ' + ELEMENTS[userBazi.luckyElements[0]].colors[0] + ' colors.';
  } else {
    recommendation = 'Balanced day. Enhance with ' + ELEMENTS[userBazi.luckyElements[0]].colors[0] + '.';
  }
  
  return {
    date, dayElement, recommendation,
    luckyColors: userBazi.luckyColors,
    unluckyColors: userBazi.unluckyColors,
  };
}
</file>

<file path="src/lib/elements.ts">
// Five Elements (‰∫îË°å) definitions and color mappings

export type Element = 'metal' | 'wood' | 'water' | 'fire' | 'earth';

export interface ElementInfo {
  name: Element;
  chinese: string;
  symbol: string;
  colors: string[];
  colorCodes: string[];
  description: {
    en: string;
    zh: string;
  };
}

export const ELEMENTS: Record<Element, ElementInfo> = {
  metal: {
    name: 'metal',
    chinese: 'Èáë',
    symbol: 'ü™ô',
    colors: ['White', 'Gold', 'Silver', 'Gray'],
    colorCodes: ['#FFFFFF', '#FFD700', '#C0C0C0', '#808080'],
    description: {
      en: 'Metal represents strength, determination, and clarity',
      zh: 'Èáë‰ª£Ë°®ÂùöÂº∫„ÄÅÂÜ≥Êñ≠ÂíåÊ∏ÖÊòé',
    },
  },
  wood: {
    name: 'wood',
    chinese: 'Êú®',
    symbol: 'üå≥',
    colors: ['Green', 'Teal', 'Emerald', 'Forest Green'],
    colorCodes: ['#228B22', '#008080', '#50C878', '#228B22'],
    description: {
      en: 'Wood represents growth, vitality, and creativity',
      zh: 'Êú®‰ª£Ë°®ÊàêÈïø„ÄÅÊ¥ªÂäõÂíåÂàõÈÄ†Âäõ',
    },
  },
  water: {
    name: 'water',
    chinese: 'Ê∞¥',
    symbol: 'üíß',
    colors: ['Blue', 'Black', 'Navy', 'Dark Blue'],
    colorCodes: ['#0000FF', '#000000', '#000080', '#00008B'],
    description: {
      en: 'Water represents wisdom, flexibility, and intuition',
      zh: 'Ê∞¥‰ª£Ë°®Êô∫ÊÖß„ÄÅÁÅµÊ¥ªÂíåÁõ¥Ëßâ',
    },
  },
  fire: {
    name: 'fire',
    chinese: 'ÁÅ´',
    symbol: 'üî•',
    colors: ['Red', 'Orange', 'Pink', 'Purple'],
    colorCodes: ['#FF0000', '#FFA500', '#FFC0CB', '#800080'],
    description: {
      en: 'Fire represents passion, energy, and transformation',
      zh: 'ÁÅ´‰ª£Ë°®ÁÉ≠ÊÉÖ„ÄÅËÉΩÈáèÂíåÂèòÂåñ',
    },
  },
  earth: {
    name: 'earth',
    chinese: 'Âúü',
    symbol: 'üåç',
    colors: ['Yellow', 'Brown', 'Beige', 'Tan'],
    colorCodes: ['#FFFF00', '#8B4513', '#F5F5DC', '#D2B48C'],
    description: {
      en: 'Earth represents stability, nourishment, and balance',
      zh: 'Âúü‰ª£Ë°®Á®≥ÂÆö„ÄÅÊªãÂÖªÂíåÂπ≥Ë°°',
    },
  },
};

// Element relationships
export const ELEMENT_GENERATES: Record<Element, Element> = {
  wood: 'fire',    // Wood feeds Fire
  fire: 'earth',   // Fire creates Earth (ash)
  earth: 'metal',  // Earth bears Metal
  metal: 'water',  // Metal collects Water
  water: 'wood',   // Water nourishes Wood
};

export const ELEMENT_CONTROLS: Record<Element, Element> = {
  wood: 'earth',   // Wood controls Earth (roots)
  earth: 'water',  // Earth controls Water (dam)
  water: 'fire',   // Water controls Fire
  fire: 'metal',   // Fire controls Metal (melting)
  metal: 'wood',   // Metal controls Wood (cutting)
};

// Get lucky element based on weak element
export function getLuckyElement(weakElement: Element): Element {
  // The element that generates the weak element is lucky
  const generators: Record<Element, Element> = {
    wood: 'water',
    fire: 'wood',
    earth: 'fire',
    metal: 'earth',
    water: 'metal',
  };
  return generators[weakElement];
}

// Get colors to wear based on lucky elements
export function getLuckyColors(luckyElements: Element[]): { color: string; code: string; element: Element }[] {
  const colors: { color: string; code: string; element: Element }[] = [];
  
  luckyElements.forEach(element => {
    const info = ELEMENTS[element];
    info.colors.forEach((color, index) => {
      colors.push({
        color,
        code: info.colorCodes[index],
        element,
      });
    });
  });
  
  return colors;
}

// Get colors to avoid based on controlling element
export function getUnluckyColors(strongElement: Element): { color: string; code: string; element: Element }[] {
  const controlledBy = Object.entries(ELEMENT_CONTROLS).find(
    ([, controlled]) => controlled === strongElement
  )?.[0] as Element | undefined;
  
  if (!controlledBy) return [];
  
  const info = ELEMENTS[controlledBy];
  return info.colors.map((color, index) => ({
    color,
    code: info.colorCodes[index],
    element: controlledBy,
  }));
}
</file>

<file path="src/lib/gemini.ts">
// Gemini API client for outfit analysis
import { GoogleGenerativeAI } from '@google/generative-ai';

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || '');

export interface OutfitAnalysisResult {
  analysis: string;
  detectedColors: string[];
  colorMatch: 'excellent' | 'good' | 'neutral' | 'poor';
  suggestions: string[];
  elementAlignment: string;
}

export async function analyzeOutfit(
  imageBase64: string,
  luckyColors: { color: string; code: string }[],
  unluckyColors: { color: string; code: string }[]
): Promise<OutfitAnalysisResult> {
  const model = genAI.getGenerativeModel({ model: 'gemini-1.5-flash' });
  
  const luckyColorNames = luckyColors.map(c => c.color).join(', ');
  const unluckyColorNames = unluckyColors.map(c => c.color).join(', ');
  
  const prompt = `You are a Feng Shui fashion advisor analyzing an outfit photo.

The user's lucky colors based on their BaZi (ÂÖ´Â≠ó) analysis are: ${luckyColorNames}
The colors they should avoid are: ${unluckyColorNames}

Please analyze the outfit in the image and provide:
1. A brief description of the colors visible in the outfit
2. How well the outfit aligns with their lucky colors (excellent/good/neutral/poor)
3. Specific suggestions for improvement based on Five Elements (‰∫îË°å) principles
4. Which element (Metal/Wood/Water/Fire/Earth) the outfit currently represents

Respond in JSON format:
{
  "analysis": "Brief friendly analysis of the outfit",
  "detectedColors": ["color1", "color2"],
  "colorMatch": "excellent|good|neutral|poor",
  "suggestions": ["suggestion1", "suggestion2"],
  "elementAlignment": "Description of element alignment"
}`;

  try {
    const result = await model.generateContent([
      prompt,
      {
        inlineData: {
          mimeType: 'image/jpeg',
          data: imageBase64,
        },
      },
    ]);
    
    const response = await result.response;
    const text = response.text();
    
    // Parse JSON from response
    const jsonMatch = text.match(/{[sS]*}/);
    if (jsonMatch) {
      return JSON.parse(jsonMatch[0]);
    }
    
    // Fallback if JSON parsing fails
    return {
      analysis: text,
      detectedColors: [],
      colorMatch: 'neutral',
      suggestions: ['Unable to parse detailed suggestions'],
      elementAlignment: 'Analysis in progress',
    };
  } catch (error) {
    console.error('Gemini API error:', error);
    throw new Error('Failed to analyze outfit');
  }
}

export async function analyzeOutfitStream(
  imageBase64: string,
  luckyColors: { color: string; code: string }[],
  unluckyColors: { color: string; code: string }[],
  onChunk: (text: string) => void
): Promise<void> {
  const model = genAI.getGenerativeModel({ model: 'gemini-1.5-flash' });
  
  const luckyColorNames = luckyColors.map(c => c.color).join(', ');
  const unluckyColorNames = unluckyColors.map(c => c.color).join(', ');
  
  const prompt = `You are a friendly Feng Shui fashion advisor. Analyze this outfit photo.

Lucky colors for today: ${luckyColorNames}
Colors to avoid: ${unluckyColorNames}

Give real-time, conversational feedback about:
1. What colors you see
2. How well they match the lucky colors
3. Quick suggestions

Keep it brief and encouraging!`;

  const result = await model.generateContentStream([
    prompt,
    {
      inlineData: {
        mimeType: 'image/jpeg',
        data: imageBase64,
      },
    },
  ]);
  
  for await (const chunk of result.stream) {
    const text = chunk.text();
    if (text) {
      onChunk(text);
    }
  }
}
</file>

<file path="src/types/lunar-javascript.d.ts">
declare module 'lunar-javascript' {
  export class Solar {
    static fromYmd(year: number, month: number, day: number): Solar;
    static fromYmdHms(year: number, month: number, day: number, hour: number, minute: number, second: number): Solar;
    getLunar(): Lunar;
  }

  export class Lunar {
    getEightChar(): EightChar;
    getYearInChinese(): string;
    getMonthInChinese(): string;
    getDayInChinese(): string;
  }

  export class EightChar {
    getYear(): string;
    getYearGan(): string;
    getYearZhi(): string;
    getMonth(): string;
    getMonthGan(): string;
    getMonthZhi(): string;
    getDay(): string;
    getDayGan(): string;
    getDayZhi(): string;
    getTime(): string;
    getTimeGan(): string;
    getTimeZhi(): string;
  }
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="package.json">
{
  "name": "feng-shui-banana",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@google/generative-ai": "^0.24.1",
    "lunar-javascript": "^1.7.7",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="README.md">
# Feng Shui Banana

A Next.js application for BaZi (ÂÖ´Â≠ó) analysis that provides personalized clothing color recommendations based on the Five Elements, with AI-powered outfit analysis via Google Gemini API.

## Features

### BaZi Analysis (ÂÖ´Â≠óÂàÜÊûê)
- Input your gender and birth date (birth time optional)
- Calculate your Four Pillars (ÂõõÊü±): Year, Month, Day, and Hour pillars
- Analyze your Five Elements (‰∫îË°å) balance: Metal, Wood, Water, Fire, Earth
- Get personalized lucky and unlucky color recommendations

### Outfit Analysis
- **Photo Upload**: Upload an outfit photo for AI analysis
- **Live Camera**: Real-time camera feed with instant AI feedback
- Gemini AI compares your outfit colors against your lucky colors
- Get personalized suggestions to improve your outfit alignment

## Tech Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS (custom sepia theme)
- **BaZi Logic**: lunar-javascript library
- **AI**: Google Gemini API

## Getting Started

### Prerequisites

- Node.js 18+
- Google Gemini API key

### Installation

1. Clone the repository:
```bash
git clone <your-repo-url>
cd feng-shui-banana
```

2. Install dependencies:
```bash
npm install
```

3. Create a `.env.local` file with your Gemini API key:
```
GEMINI_API_KEY=your_api_key_here
```

4. Run the development server:
```bash
npm run dev
```

5. Open [http://localhost:3000](http://localhost:3000) in your browser.

## Project Structure

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # Landing page
‚îÇ   ‚îú‚îÄ‚îÄ bazi/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # BaZi input form
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ result/page.tsx   # BaZi results display
‚îÇ   ‚îú‚îÄ‚îÄ outfit/page.tsx       # Outfit analysis (camera/upload)
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ bazi/route.ts     # BaZi calculation endpoint
‚îÇ       ‚îî‚îÄ‚îÄ gemini/analyze/route.ts  # Gemini analysis endpoint
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ bazi.ts               # BaZi calculation logic
‚îÇ   ‚îî‚îÄ‚îÄ elements.ts           # Five Elements definitions
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ lunar-javascript.d.ts # Type declarations
```

## Five Elements Color Mapping

| Element | Chinese | Colors |
|---------|---------|--------|
| Metal | Èáë | White, Gold, Silver, Gray |
| Wood | Êú® | Green, Teal, Emerald |
| Water | Ê∞¥ | Blue, Black, Navy |
| Fire | ÁÅ´ | Red, Orange, Pink, Purple |
| Earth | Âúü | Yellow, Brown, Beige, Tan |

## Deployment

Deploy on Vercel:

1. Push your code to GitHub
2. Connect your repository to Vercel
3. Add `GEMINI_API_KEY` to environment variables
4. Deploy

## License

MIT
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

</files>
